<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todos</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body style="background: #F4EFEA; font-family: 'Inter', sans-serif; color: #383838; margin: 0; padding: 0; min-height: 100vh;">
    <div style="max-width: 640px; margin: 0 auto; padding: 40px 24px;">
        <!-- Header -->
        <header style="margin-bottom: 48px;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
                <div style="width: 48px; height: 48px; background: #383838; border: 2px solid #383838; border-radius: 2px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="check-square" style="color: #F4EFEA; width: 24px; height: 24px;"></i>
                </div>
                <h1 style="font-family: 'Space Mono', monospace; font-size: 56px; font-weight: 400; text-transform: uppercase; letter-spacing: -0.02em; margin: 0;">TODOS</h1>
            </div>
            <div style="background: #383838; color: #FFFFFF; font-family: 'Space Mono', monospace; font-size: 18px; font-weight: 400; text-transform: uppercase; padding: 8px 12px; border-radius: 2px; display: inline-block;">
                Your daily tasks, simplified
            </div>
        </header>

        <!-- Add Todo Form -->
        <div style="background: #FFFFFF; border: 2px solid #383838; box-shadow: -8px 8px 0 0 #383838; border-radius: 2px; padding: 24px; margin-bottom: 32px;">
            <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                <input
                    type="text"
                    id="todoInput"
                    placeholder="What needs to be done?"
                    style="flex: 1; background: rgba(248,248,247,0.7); border: 2px solid #383838; border-radius: 2px; font: 400 16px 'Inter', sans-serif; padding: 16px; outline: none; transition: border-color 0.12s ease-in-out;"
                    onfocus="this.style.borderColor = '#2BA5FF'"
                    onblur="this.style.borderColor = '#383838'"
                />
                <button
                    onclick="addTodo()"
                    style="background: #6FC2FF; border: 2px solid #383838; border-radius: 2px; color: #383838; text-transform: uppercase; font: 400 16px 'Inter', sans-serif; padding: 16px 22px; cursor: pointer; transition: transform 0.12s ease-in-out; box-shadow: -6px 6px 0 0 #383838;"
                    onmouseover="this.style.transform = 'translate(7px, -7px)'"
                    onmouseout="this.style.transform = 'translate(0px, 0px)'"
                    onmousedown="this.style.transform = 'translate(0px, 0px)'"
                    onmouseup="this.style.transform = 'translate(7px, -7px)'"
                >
                    Add
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; margin-bottom: 32px;">
            <div style="background: #FFFFFF; border: 2px solid #383838; box-shadow: -6px 6px 0 0 #383838; border-radius: 2px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; font-weight: 700; color: #383838; margin-bottom: 4px;" id="totalCount">0</div>
                <div style="font-size: 14px; text-transform: uppercase; letter-spacing: 0.08em; color: #A1A1A1;">Total</div>
            </div>
            <div style="background: #FFFFFF; border: 2px solid #53DBC9; box-shadow: -6px 6px 0 0 #53DBC9; border-radius: 2px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; font-weight: 700; color: #383838; margin-bottom: 4px;" id="completedCount">0</div>
                <div style="font-size: 14px; text-transform: uppercase; letter-spacing: 0.08em; color: #A1A1A1;">Done</div>
            </div>
            <div style="background: #FFFFFF; border: 2px solid #FFDE00; box-shadow: -6px 6px 0 0 #FFDE00; border-radius: 2px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; font-weight: 700; color: #383838; margin-bottom: 4px;" id="pendingCount">0</div>
                <div style="font-size: 14px; text-transform: uppercase; letter-spacing: 0.08em; color: #A1A1A1;">Pending</div>
            </div>
        </div>

        <!-- Filter Tabs -->
        <div style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 2px solid #383838; padding-bottom: 16px;">
            <button
                onclick="filterTodos('all')"
                id="filter-all"
                style="background: #383838; color: #FFFFFF; border: none; border-radius: 2px; padding: 8px 16px; font: 400 14px 'Inter', sans-serif; text-transform: uppercase; cursor: pointer;"
            >
                All
            </button>
            <button
                onclick="filterTodos('pending')"
                id="filter-pending"
                style="background: #F4EFEA; color: #383838; border: 2px solid #383838; border-radius: 2px; padding: 8px 16px; font: 400 14px 'Inter', sans-serif; text-transform: uppercase; cursor: pointer; transition: transform 0.12s ease-in-out; box-shadow: -4px 4px 0 0 #383838;"
                onmouseover="this.style.transform = 'translate(4px, -4px)'"
                onmouseout="this.style.transform = 'translate(0px, 0px)'"
            >
                Pending
            </button>
            <button
                onclick="filterTodos('completed')"
                id="filter-completed"
                style="background: #F4EFEA; color: #383838; border: 2px solid #383838; border-radius: 2px; padding: 8px 16px; font: 400 14px 'Inter', sans-serif; text-transform: uppercase; cursor: pointer; transition: transform 0.12s ease-in-out; box-shadow: -4px 4px 0 0 #383838;"
                onmouseover="this.style.transform = 'translate(4px, -4px)'"
                onmouseout="this.style.transform = 'translate(0px, 0px)'"
            >
                Completed
            </button>
            <div style="flex:1"></div>
            <button onclick="clearCompleted()" style="background:#FFFFFF; color:#383838; border:2px solid #383838; border-radius:2px; padding:8px 12px; font:400 12px 'Inter', sans-serif; text-transform:uppercase; cursor:pointer; box-shadow:-4px 4px 0 0 #383838;">
                Clear Completed
            </button>
        </div>

        <!-- Todo List -->
        <div id="todoList" style="display: flex; flex-direction: column; gap: 16px;">
            <!-- Todos will be added here dynamically -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" style="background: #FFFFFF; border: 2px solid #383838; box-shadow: -8px 8px 0 0 #383838; border-radius: 2px; padding: 48px 24px; text-align: center;">
            <div style="width: 80px; height: 80px; background: #F4EFEA; border: 2px solid #383838; border-radius: 2px; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="coffee" style="color: #383838; width: 40px; height: 40px;"></i>
            </div>
            <h3 style="font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 400; text-transform: uppercase; margin: 0 0 12px 0;">No tasks yet</h3>
            <p style="font-size: 16px; font-weight: 300; margin: 0; color: #A1A1A1;">Add your first task to get started!</p>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'md_todos_v1';
        let todos = [];
        let currentFilter = 'all';

        function loadTodos(){
            try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch { return []; }
        }
        function saveTodos(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)); }
        function uid(){ return Math.random().toString(36).slice(2,9); }

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();

            if (text === '') return;

            const todo = {
                id: uid(),
                text: text,
                completed: false,
                createdAt: new Date()
            };

            todos.unshift(todo);
            input.value = '';
            renderTodos();
            updateStats();
            saveTodos();
        }

        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                renderTodos();
                updateStats();
                saveTodos();
            }
        }

        function deleteTodo(id) {
            todos = todos.filter(t => t.id !== id);
            renderTodos();
            updateStats();
            saveTodos();
        }

        function clearCompleted(){
            const before = todos.length;
            todos = todos.filter(t=>!t.completed);
            if(todos.length !== before){ saveTodos(); }
            renderTodos();
            updateStats();
        }

        function filterTodos(filter) {
            currentFilter = filter;

            // Update button styles
            document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                btn.style.background = '#F4EFEA';
                btn.style.color = '#383838';
                btn.style.border = '2px solid #383838';
                btn.style.boxShadow = '-4px 4px 0 0 #383838';
            });

            const activeBtn = document.getElementById(`filter-${filter}`);
            activeBtn.style.background = '#383838';
            activeBtn.style.color = '#FFFFFF';
            activeBtn.style.border = 'none';
            activeBtn.style.boxShadow = 'none';

            renderTodos();
            saveTodos();
        }

        function getFilteredTodos() {
            switch (currentFilter) {
                case 'pending':
                    return todos.filter(t => !t.completed);
                case 'completed':
                    return todos.filter(t => t.completed);
                default:
                    return todos;
            }
        }

        function renderTodos() {
            const todoList = document.getElementById('todoList');
            const emptyState = document.getElementById('emptyState');
            const filteredTodos = getFilteredTodos();

            if (filteredTodos.length === 0) {
                todoList.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            todoList.style.display = 'flex';
            emptyState.style.display = 'none';

            todoList.innerHTML = filteredTodos.map(todo => `
                <div class="todo-row" data-id="${todo.id}" draggable="true" style="background:#FFFFFF; border:2px solid ${todo.completed ? '#53DBC9' : '#383838'}; box-shadow:-6px 6px 0 0 ${todo.completed ? '#53DBC9' : '#383838'}; border-radius:2px; padding:16px; display:flex; align-items:center; gap:12px; transition: transform 0.12s ease-in-out;"
                    onmouseover="this.style.transform='translate(4px,-4px)'" onmouseout="this.style.transform='translate(0,0)'">
                    <span class="drag-handle" style="cursor:grab; display:flex; align-items:center; color:#383838;"><i data-lucide="grip-vertical" style="width:16px;height:16px;"></i></span>
                    <div style="width:20px; height:20px; border:2px solid #383838; border-radius:2px; cursor:pointer; background:${todo.completed ? '#53DBC9' : 'transparent'}; display:flex; align-items:center; justify-content:center; flex-shrink:0;" onclick="toggleTodo('${todo.id}')">${todo.completed ? '<i data-lucide="check" style="color:#383838; width:14px; height:14px;"></i>' : ''}</div>
                    <div class="todo-text" style="flex:1; font-size:16px; ${todo.completed ? 'text-decoration: line-through; color:#A1A1A1;' : ''}" ondblclick="startEdit('${todo.id}')">${todo.text}</div>
                    <button onclick="startEdit('${todo.id}')" style="background:#FFFFFF; border:2px solid #383838; border-radius:2px; color:#383838; padding:8px 12px; font:400 12px 'Inter', sans-serif; text-transform:uppercase; cursor:pointer; box-shadow:-3px 3px 0 0 #383838;">Edit</button>
                    <button onclick="deleteTodo('${todo.id}')" style="background:#FF7169; border:2px solid #383838; border-radius:2px; color:#383838; padding:8px 12px; font:400 12px 'Inter', sans-serif; text-transform:uppercase; cursor:pointer; box-shadow:-3px 3px 0 0 #383838;">Delete</button>
                </div>
            `).join('');

            // Reinitialize Lucide icons and enable drag
            lucide.createIcons();
            applyDragEvents();
        }

        function startEdit(id){
            const row = document.querySelector(`.todo-row[data-id="${id}"]`);
            if(!row) return;
            const textEl = row.querySelector('.todo-text');
            const current = textEl.textContent;
            const input = document.createElement('input');
            input.type='text'; input.value=current; input.style.flex='1'; input.style.fontSize='16px'; input.style.border='2px solid #2BA5FF'; input.style.borderRadius='2px'; input.style.padding='8px 10px';
            function commit(){
                const v = (input.value||'').trim(); if(!v){ renderTodos(); return; }
                const t = todos.find(x=>x.id===id); if(t){ t.text=v; saveTodos(); }
                renderTodos();
            }
            input.addEventListener('keydown', e=>{ if(e.key==='Enter') commit(); if(e.key==='Escape') renderTodos(); });
            input.addEventListener('blur', commit);
            textEl.replaceWith(input); input.focus(); input.select();
        }

        function applyDragEvents(){
            const list = document.getElementById('todoList');
            // track whether drag was initiated from the handle
            let allowDrag = false;
            list.onmousedown = (e)=>{ allowDrag = !!e.target.closest('.drag-handle'); };
            list.onmouseup = ()=>{ allowDrag = false; };
            list.querySelectorAll('.todo-row').forEach(row=>{
                row.addEventListener('dragstart', (e)=>{
                    if(!allowDrag) { e.preventDefault(); return; }
                    e.dataTransfer.effectAllowed='move';
                    try{ e.dataTransfer.setData('text/plain', row.dataset.id); }catch{}
                    row.classList.add('dragging');
                });
                row.addEventListener('dragend', ()=>{ row.classList.remove('dragging'); persistOrderFromDOM(); });
            });
            list.ondragover = (e)=>{
                e.preventDefault();
                if(e.dataTransfer) e.dataTransfer.dropEffect = 'move';
                const dragging = list.querySelector('.dragging');
                if(!dragging) return;
                const after = Array.from(list.querySelectorAll('.todo-row:not(.dragging)'))
                  .find(el=> e.clientY <= el.getBoundingClientRect().top + el.offsetHeight/2);
                if(after) list.insertBefore(dragging, after); else list.appendChild(dragging);
            };
        }

        function persistOrderFromDOM(){
            const ids = Array.from(document.querySelectorAll('.todo-row')).map(el=>el.dataset.id);
            const map = Object.fromEntries(todos.map(t=>[t.id,t]));
            todos = ids.map(id=>map[id]).filter(Boolean);
            saveTodos();
        }

        function updateStats() {
            const total = todos.length;
            const completed = todos.filter(t => t.completed).length;
            const pending = total - completed;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('pendingCount').textContent = pending;
        }

        // Handle Enter key in input
        document.getElementById('todoInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTodo();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            todos = loadTodos();
            renderTodos();
            updateStats();
        });

        // Toggle All and keyboard shortcuts (j/k navigate, x toggle, e edit, del remove)
        function toggleAll(){
            const allDone = todos.length>0 && todos.every(t=>t.completed);
            todos.forEach(t=> t.completed = !allDone);
            saveTodos(); renderTodos(); updateStats();
        }

        let focusIndex = -1;
        function setFocusByIndex(idx){
            const rows = Array.from(document.querySelectorAll('.todo-row'));
            if(rows.length===0) return;
            focusIndex = (idx+rows.length)%rows.length;
            rows.forEach(r=> r.style.outline='none');
            const row = rows[focusIndex];
            row.scrollIntoView({block:'nearest'});
            row.style.outline = '2px solid #2BA5FF';
        }
        document.addEventListener('keydown', (e)=>{
            const rows = document.querySelectorAll('.todo-row');
            if(rows.length===0) return;
            const tag = document.activeElement.tagName;
            if(tag==='INPUT' || tag==='TEXTAREA') return;
            if(e.key==='j'){ setFocusByIndex((focusIndex<0?0:focusIndex+1)); }
            else if(e.key==='k'){ setFocusByIndex((focusIndex<0?0:focusIndex-1)); }
            else if(e.key==='x' && focusIndex>=0){ const id = rows[focusIndex].dataset.id; toggleTodo(id); }
            else if(e.key==='e' && focusIndex>=0){ const id = rows[focusIndex].dataset.id; startEdit(id); }
            else if((e.key==='Delete' || e.key==='Backspace') && focusIndex>=0){ const id = rows[focusIndex].dataset.id; deleteTodo(id); }
        });
    </script>
</body>
</html>
