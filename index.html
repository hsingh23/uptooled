<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Browse handy utilities and preview them inline.">
  <meta name="keywords" content="tools, gallery, productivity">
  <title>Tool Gallery - UpTooled</title>
  <link rel="icon" href="favicon.png">
  <link rel="preload" href="tools.json" as="fetch" crossorigin>
  <link rel="preload" href="external-sites.json" as="fetch" crossorigin>
  <link rel="stylesheet" href="https://cdn.muicss.com/mui-latest/css/mui.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
  :root {
    --bg: #0a0e1a;
    --surface: #0f1623;
    --panel: #131b2e;
    --elev: #1a2337;
    --text: #e8eaed;
    --muted: #9ca3af;
    --border: #2a3447;
    --primary: #6366f1;
    --primary-light: #818cf8;
    --primary-dark: #4f46e5;
    --primary-contrast: #ffffff;
    --accent: #22d3ee;
    --accent-light: #67e8f9;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --shadow-1: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-2: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-3: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.3);
    --radius: 16px;
    --radius-sm: 12px;
    --radius-lg: 20px;
  }
  @media (prefers-color-scheme: light) {
    :root {
      --bg: #f8fafc;
      --surface: #ffffff;
      --panel: #f1f5f9;
      --elev: #f8fafc;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --primary: #6366f1;
      --primary-light: #818cf8;
      --primary-dark: #4f46e5;
      --primary-contrast: #ffffff;
      --accent: #06b6d4;
      --accent-light: #22d3ee;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow-1: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-2: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-3: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.2);
    }
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: 
      radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
      radial-gradient(ellipse at bottom right, rgba(34, 211, 238, 0.1) 0%, transparent 50%),
      linear-gradient(135deg, var(--bg) 0%, var(--surface) 100%);
    color: var(--text);
    font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    letter-spacing: -0.01em;
    line-height: 1.6;
    overflow: hidden;
  }
  
  /* Scrollbar styling */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    background: var(--panel);
  }
  ::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: var(--muted);
  }
  
  /* Header */
  #header {
    padding: 1.5rem;
    text-align: center;
    background: var(--panel);
    border-bottom: 1px solid var(--border);
  }
  #header strong {
    font-weight: 800;
    font-size: 1.75rem;
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -0.02em;
    display: block;
    margin-bottom: 0.5rem;
  }
  #header p {
    color: var(--muted);
    margin: 0;
    font-size: 1rem;
    max-width: 600px;
    margin: 0 auto;
  }
  
  /* Search bar */
  #search-container {
    padding: 1rem 1.5rem;
    background: var(--panel);
    border-bottom: 1px solid var(--border);
  }
  .mui-textfield { margin: 0; max-width: 600px; margin: 0 auto; }
  .mui-textfield input#search {
    background: var(--elev);
    border: 2px solid var(--border);
    color: var(--text);
    border-radius: var(--radius-lg);
    padding: 0.75rem 1rem 0.75rem 3rem;
    height: 48px;
    font-size: 15px;
    font-weight: 500;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    transition: all 0.2s ease;
    width: 100%;
  }
  .mui-textfield input#search::placeholder { 
    color: var(--muted); 
    font-weight: 400;
  }
  .mui-textfield input#search:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1), inset 0 2px 4px rgba(0,0,0,0.1);
  }
  .mui-textfield {
    position: relative;
  }
  .mui-textfield::before {
    content: '\f002';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    z-index: 1;
    font-size: 14px;
  }
  
  /* Layout */
  #content-wrapper {
    display: flex;
    flex: 1;
    overflow: hidden;
  }
  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    min-width: 0;
    background: var(--surface);
  }
  
  /* Grid */
  #grid-view {
    display: grid;
    gap: 1.5rem;
    padding: 2rem;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    overflow-y: auto;
    align-content: start;
  }
  @media (min-width: 1280px) {
    #grid-view { grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); }
  }
  .tool-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 1.5rem;
    box-shadow: var(--shadow-1);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    height: 420px;
  }
  .tool-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--primary), transparent);
    transform: translateX(-100%);
    transition: transform 0.6s ease;
  }
  .tool-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-3);
    border-color: var(--primary);
    background: var(--elev);
  }
  .tool-card:hover::before {
    transform: translateX(100%);
  }
  .card-frame {
    width: 100%;
    height: 240px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    object-fit: cover;
    background: var(--bg);
    transition: all 0.3s ease;
  }
  .tool-card:hover .card-frame {
    border-color: var(--primary);
    box-shadow: var(--shadow-glow);
  }
  .tool-card h3 {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 700;
    letter-spacing: -0.01em;
    line-height: 1.3;
    color: var(--text);
  }
  .tool-card p {
    margin: 0;
    font-size: 0.875rem;
    color: var(--muted);
    line-height: 1.5;
    flex: 1;
  }
  
  /* Viewer */
  #viewer { 
    display: none; 
    flex: 1; 
    flex-direction: column; 
    overflow: hidden;
    background: var(--surface);
    position: relative;
  }
  
  /* Floating buttons */
  .floating-controls {
    position: absolute;
    top: 1rem;
    left: 1rem;
    z-index: 100;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .floating-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(15, 22, 35, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--text);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-2);
  }
  .floating-btn:hover {
    background: var(--primary);
    transform: scale(1.1);
    box-shadow: var(--shadow-3);
  }
  #tool-frame {
    flex: 1;
    border: none;
    width: 100%;
    background: var(--bg);
    border-radius: 0;
  }
  #tool-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(15, 22, 35, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid var(--border);
    padding: 1.5rem;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    max-height: 50vh;
    overflow-y: auto;
  }
  #tool-info.visible {
    transform: translateY(0);
  }
  #tool-title {
    margin: 0 0 0.5rem;
    font-size: 1.375rem;
    font-weight: 800;
    letter-spacing: -0.02em;
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  #tool-description { 
    margin: 0.5rem 0; 
    color: var(--muted);
    font-size: 1rem;
    line-height: 1.6;
  }
  #tool-keywords { 
    color: var(--muted);
    font-size: 0.875rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  #tool-keywords span {
    background: var(--elev);
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    border: 1px solid var(--border);
  }
  #tool-related {
    margin-top: 1rem;
    font-size: 0.875rem;
  }
  #tool-related a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }
  #tool-related a:hover {
    color: var(--primary-light);
    text-decoration: underline;
  }
  
  /* Search overlay */
  #search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    z-index: 200;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }
  #search-overlay.active {
    display: flex;
  }
  .search-container {
    width: 100%;
    max-width: 600px;
    background: var(--panel);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow-3);
  }
  .search-container h3 {
    margin-top: 0;
    margin-bottom: 1rem;
    color: var(--text);
  }
  .search-container input {
    width: 100%;
    background: var(--elev);
    border: 2px solid var(--border);
    color: var(--text);
    border-radius: var(--radius-lg);
    padding: 0.75rem 1rem 0.75rem 3rem;
    height: 48px;
    font-size: 15px;
    font-weight: 500;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    transition: all 0.2s ease;
  }
  .search-container input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1), inset 0 2px 4px rgba(0,0,0,0.1);
  }
  .search-results {
    margin-top: 1rem;
    max-height: 300px;
    overflow-y: auto;
  }
  .search-result-item {
    padding: 0.75rem;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: background 0.2s ease;
  }
  .search-result-item:hover {
    background: var(--elev);
  }
  .search-result-item h4 {
    margin: 0 0 0.25rem;
    color: var(--text);
  }
  .search-result-item p {
    margin: 0;
    color: var(--muted);
    font-size: 0.875rem;
  }
  
  /* Mobile */
  @media (max-width: 768px) {
    #header {
      padding: 1rem;
    }
    #header strong {
      font-size: 1.5rem;
    }
    #header p {
      font-size: 0.875rem;
    }
    #search-container {
      padding: 0.75rem 1rem;
    }
    .mui-textfield input#search {
      height: 40px; 
      font-size: 14px; 
      padding: 0.5rem 1rem 0.5rem 2.5rem;
    }
    #grid-view {
      grid-template-columns: 1fr;
      gap: 1rem;
      padding: 1rem;
    }
    .card-frame { height: 180px; }
    .tool-card {
      padding: 1rem;
      height: 320px;
    }
    .tool-card h3 {
      font-size: 1rem;
    }
    .tool-card p {
      font-size: 0.813rem;
    }
    .floating-btn {
      width: 40px;
      height: 40px;
    }
    #tool-info {
      padding: 1rem;
    }
    #tool-title { 
      font-size: 1.125rem;
    }
    #tool-description {
      font-size: 0.875rem;
    }
  }
  
  /* Nice scrolling and touch */
  #grid-view, #viewer, .search-results { 
    -webkit-overflow-scrolling: touch; 
    scroll-behavior: smooth;
  }
  
  /* Focus & motion preferences */
  :focus-visible { 
    outline: 2px solid var(--accent); 
    outline-offset: 2px; 
  }
  @media (prefers-reduced-motion: reduce) {
    * { transition: none !important; animation: none !important; }
  }
  
  /* Safe areas */
  @supports (padding: max(0px)) {
    #header, #search-container { 
      padding-left: max(1rem, env(safe-area-inset-left));
      padding-right: max(1rem, env(safe-area-inset-right));
    }
    #grid-view { 
      padding-left: max(1.5rem, env(safe-area-inset-left));
      padding-right: max(1.5rem, env(safe-area-inset-right));
    }
    .floating-controls {
      left: max(1rem, env(safe-area-inset-left));
    }
  }
  
  /* Loading animation */
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid var(--border);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s ease-in-out infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Empty state */
  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--muted);
  }
  .empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }
  </style>
</head>
<body>
  <div id="header">
    <strong>UpTooled</strong>
    <p>Browse handy utilities and preview them inline</p>
  </div>
  
  <div id="search-container">
    <div class="mui-textfield">
      <input type="text" id="search" placeholder="Search tools..." inputmode="search" />
    </div>
  </div>
  
  <div id="content-wrapper">
    <div id="main">
      <div id="grid-view"></div>
      <div id="viewer">
        <div class="floating-controls">
          <div id="back-button" class="floating-btn" title="Back to gallery">
            <i class="fas fa-arrow-left"></i>
          </div>
          <div id="search-button" class="floating-btn" title="Search tools">
            <i class="fas fa-search"></i>
          </div>
          <div id="info-button" class="floating-btn" title="Toggle tool info">
            <i class="fas fa-info-circle"></i>
          </div>
          <div id="edit-file" class="floating-btn" title="Edit file" style="display:none;">
            <i class="fas fa-edit"></i>
          </div>
        </div>
        <iframe id="tool-frame"></iframe>
        <div id="tool-info">
          <h3 id="tool-title"></h3>
          <p id="tool-description"></p>
          <div id="tool-keywords"></div>
          <p id="tool-related"></p>
        </div>
      </div>
    </div>
  </div>
  
  <div id="search-overlay">
    <div class="search-container">
      <h3>Search Tools</h3>
      <input type="text" id="overlay-search" placeholder="Search tools..." />
      <div class="search-results" id="search-results"></div>
    </div>
  </div>
  
  <script>
// Render grid view and iframe viewer for tools
async function init() {
  const res = await fetch('tools.json');
  const tools = await res.json();
  let external = [];
  try {
    const extRes = await fetch('external-sites.json');
    if (extRes.ok) {
      external = await extRes.json();
    }
  } catch (err) {
    console.error('Failed to load external sites', err);
  }
  const allTools = tools.concat(external.map(s => ({
    file: s.file || s.url,
    title: s.title || s.url,
    description: s.description || '',
    keywords: s.keywords || []
  })));
  const searchEl = document.getElementById('search');
  const overlaySearchEl = document.getElementById('overlay-search');
  const searchResultsEl = document.getElementById('search-results');
  const searchOverlayEl = document.getElementById('search-overlay');
  const gridEl = document.getElementById('grid-view');
  const viewerEl = document.getElementById('viewer');
  const frameEl = document.getElementById('tool-frame');
  const titleEl = document.getElementById('tool-title');
  const descEl = document.getElementById('tool-description');
  const keysEl = document.getElementById('tool-keywords');
  const relatedEl = document.getElementById('tool-related');
  const backBtn = document.getElementById('back-button');
  const searchBtn = document.getElementById('search-button');
  const infoBtn = document.getElementById('info-button');
  const infoEl = document.getElementById('tool-info');
  const editFileBtn = document.getElementById('edit-file');
  
  let selectedTool = null;
  let searchResults = [];
  
  function isMobile() {
    return window.matchMedia('(max-width: 768px)').matches;
  }
  
  function matches(tool, q) {
    q = q.toLowerCase();
    return (
      tool.title.toLowerCase().includes(q) ||
      tool.description.toLowerCase().includes(q) ||
      (tool.keywords || []).some(k => k.toLowerCase().includes(q))
    );
  }
  
  function renderGrid(list) {
    gridEl.innerHTML = '';
    if (list.length === 0) {
      gridEl.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-search"></i>
          <h3>No tools found</h3>
          <p>Try adjusting your search terms</p>
        </div>
      `;
      return;
    }
    for (const tool of list) {
      const card = document.createElement('div');
      card.className = 'tool-card';
      card.dataset.file = tool.file;
      
      const iframe = document.createElement('iframe');
      iframe.className = 'card-frame';
      iframe.src = tool.file;
      
      const title = document.createElement('h3');
      title.textContent = tool.title;
      
      const desc = document.createElement('p');
      desc.textContent = tool.description || '';
      
      card.appendChild(iframe);
      card.appendChild(title);
      card.appendChild(desc);
      
      card.addEventListener('click', () => selectTool(tool));
      gridEl.appendChild(card);
    }
  }
  
  function showGrid() {
    viewerEl.style.display = 'none';
    gridEl.style.display = 'grid';
    if (location.hash) {
      history.replaceState(null, '', location.pathname);
    }
  }
  
  function showViewer() {
    gridEl.style.display = 'none';
    viewerEl.style.display = 'flex';
    if (localStorage.getItem('gh_token')) {
      editFileBtn.style.display = 'flex';
    } else {
      editFileBtn.style.display = 'none';
    }
  }
  
  function selectTool(tool, updateHash = true) {
    selectedTool = tool;
    frameEl.src = tool.file;
    
    titleEl.textContent = tool.title;
    descEl.textContent = tool.description || '';
    
    // Enhanced keyword display
    keysEl.innerHTML = '';
    if (tool.keywords && tool.keywords.length) {
      const keywordContainer = document.createElement('div');
      tool.keywords.forEach(keyword => {
        const span = document.createElement('span');
        span.textContent = keyword;
        keywordContainer.appendChild(span);
      });
      keysEl.appendChild(keywordContainer);
    } else {
      keysEl.style.display = 'none';
    }
    
    relatedEl.innerHTML = '';
    if (tool.related && tool.related.length) {
      relatedEl.innerHTML = '<strong>Similar tools:</strong> ';
      tool.related.forEach((file, idx) => {
        const relTool = allTools.find(t => t.file === file);
        if (relTool) {
          const link = document.createElement('a');
          link.href = '#';
          link.innerHTML = `<i class="fas fa-external-link-alt"></i> ${relTool.title}`;
          link.addEventListener('click', e => {
            e.preventDefault();
            selectTool(relTool);
          });
          if (idx > 0) {
            relatedEl.appendChild(document.createTextNode(', '));
          }
          relatedEl.appendChild(link);
        }
      });
    }
    
    showViewer();
    if (updateHash) {
      location.hash = encodeURIComponent(tool.file);
    }
  }
  
  function filter() {
    const q = searchEl.value.trim();
    const filtered = q ? allTools.filter(t => matches(t, q)) : allTools;
    renderGrid(filtered);
    if (filtered.length === 0) {
      showGrid();
    }
  }
  
  function renderSearchResults(query) {
    searchResultsEl.innerHTML = '';
    if (!query) {
      searchResults = [];
      return;
    }
    
    searchResults = allTools.filter(t => matches(t, query));
    
    if (searchResults.length === 0) {
      searchResultsEl.innerHTML = '<div class="empty-state"><p>No tools found</p></div>';
      return;
    }
    
    searchResults.forEach(tool => {
      const item = document.createElement('div');
      item.className = 'search-result-item';
      item.innerHTML = `
        <h4>${tool.title}</h4>
        <p>${tool.description || ''}</p>
      `;
      item.addEventListener('click', () => {
        selectTool(tool);
        searchOverlayEl.classList.remove('active');
        overlaySearchEl.value = '';
      });
      searchResultsEl.appendChild(item);
    });
  }
  
  searchEl.addEventListener('input', filter);
  backBtn.addEventListener('click', showGrid);
  searchBtn.addEventListener('click', () => {
    searchOverlayEl.classList.add('active');
    overlaySearchEl.focus();
  });
  
  infoBtn.addEventListener('click', () => {
    infoEl.classList.toggle('visible');
  });
  
  editFileBtn.addEventListener('click', () => {
    if (selectedTool) {
      location.href = `edit.html?file=${encodeURIComponent(selectedTool.file)}`;
    }
  });
  
  // Close search overlay when clicking outside
  searchOverlayEl.addEventListener('click', (e) => {
    if (e.target === searchOverlayEl) {
      searchOverlayEl.classList.remove('active');
      overlaySearchEl.value = '';
    }
  });
  
  // Handle overlay search
  overlaySearchEl.addEventListener('input', (e) => {
    renderSearchResults(e.target.value);
  });
  
  window.addEventListener('hashchange', () => {
    const file = decodeURIComponent(location.hash.slice(1));
    if (file) {
      const tool = allTools.find(t => t.file === file);
      if (tool) selectTool(tool, false);
    } else {
      showGrid();
    }
  });
  
  // Initialize
  renderGrid(allTools);
  
  const startFile = decodeURIComponent(location.hash.slice(1));
  if (startFile) {
    const tool = allTools.find(t => t.file === startFile);
    if (tool) {
      selectTool(tool, false);
    } else {
      showGrid();
    }
  } else {
    showGrid();
  }
}
document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>